angular.module("app",["ngResource","ngRoute","chart.js","duScroll"]),angular.module("app").config(function(r,e){var t={admin:{auth:function(r){return r.authorizeCurrentUserForRoute("admin")}},user:{auth:function(r){return r.authorizeAuthenticatedUserForRoute()}}};e.html5Mode(!0),r.when("/",{templateUrl:"/partials/main/main",controller:"mvMainController",resolve:{load:function(r,e){var t=r.defer();return e.isAuthenticated()?t.reject("logged in"):t.resolve(),t.promise}}}).when("/admin/users",{templateUrl:"partials/admin/user-list",controller:"mvUserListController",resolve:t.admin.auth}).when("/login",{templateUrl:"partials/account/login",controller:"mvLoginController"}).when("/signup",{templateUrl:"partials/account/signup",controller:"mvSignUpController"}).when("/profile",{templateUrl:"partials/account/profile",controller:"mvProfileController",resolve:t.user.auth}).when("/typing",{templateUrl:"partials/typing/typing",controller:"mvTypingController"}).when("/results",{templateUrl:"partials/results/results",controller:"mvResultsController"}).when("/exercises",{templateUrl:"partials/exercises/exercises",controller:"mvExercisesController"}).when("/exercises/:id",{templateUrl:"partials/typing/typing",controller:"mvTypingController"}).when("/dashboard",{templateUrl:"partials/dashboard/dashboard",controller:"mvDashBoardController"})}),angular.module("app").run(function(r,e){r.$on("$routeChangeError",function(r,t,l,o){"not authorized"===o?e.path("/"):"logged in"===o&&e.path("/dashboard")})});
!function(){angular.module("app").factory("mvAuth",function(e,r,t,n){return{authenticateUser:function(u,o){var a=t.defer();return e.post("/login",{username:u,password:o}).then(function(e){if(e.data.success){var t=new n;angular.extend(t,e.data.user),r.currentUser=t,a.resolve(!0)}else a.resolve(!1)}),a.promise},createUser:function(e){var u=new n(e),o=t.defer();return u.$save().then(function(){r.currentUser=u,o.resolve()},function(e){o.reject(e.data.reason)}),o.promise},updateCurrentUser:function(e){var n=t.defer(),u=angular.copy(r.currentUser);return angular.extend(u,e),u.$update().then(function(){r.currentUser=u,n.resolve()},function(e){n.reject(e.data.reason)}),n.promise},logoutUser:function(){var n=t.defer();return e.post("/logout",{logout:!0}).then(function(){r.currentUser=void 0,n.resolve()}),n.promise},authorizeCurrentUserForRoute:function(e){return r.isAuthorized(e)?!0:t.reject("not authorized")},authorizeAuthenticatedUserForRoute:function(){return r.isAuthenticated()?!0:t.reject("not authenticated")}}})}();
!function(){angular.module("app").factory("mvIdentity",function(r,t){var e;return r.bootstrappedUserObject&&(e=new t,angular.extend(e,r.bootstrappedUserObject)),{currentUser:e,isAuthenticated:function(){return!!this.currentUser},isAuthorized:function(r){return!!this.currentUser&&this.currentUser.roles.inxexOf(r)>-1}}})}();
!function(){angular.module("app").controller("mvLoginController",function(n,o,i,t,e,r){n.identity=t,n.signin=function(o,t){r.authenticateUser(o,t).then(function(o){o?(e.notify("successfully logged in"),n.email="",n.password="",i.path("/")):e.error("username/password combination incorrect")})}})}();
!function(){angular.module("app").controller("mvNavbarController",function(o,n,t,u,e,l){o.identity=u,o.signout=function(){l.logoutUser().then(function(){o.username="",o.password="",e.notify("You have successfully logged out"),t.path("/")})}})}();
!function(){angular.module("app").controller("mvProfileController",function(e,r,n,a){e.email=n.currentUser.username,e.fname=n.currentUser.firstName,e.lname=n.currentUser.lastName,e.update=function(){var n={username:e.email,firstName:e.fname,lastName:e.lname};e.password&&e.password.length>0&&(n.password=e.password),r.updateCurrentUser(n).then(function(){a.notify("Your user information has been updated")},function(e){a.error(e)})}})}();
!function(){angular.module("app").factory("mvScores",function(r){var a=r("/api/scores");return a})}();
!function(){angular.module("app").controller("mvSignUpController",function(n,e,r,a,o){n.signup=function(){var r={username:n.email,password:n.password,firstName:n.fname,lastName:n.lname};e.createUser(r).then(function(){o.notify("New User Created"),a.path("/")},function(n){o.error(n)})}})}();
!function(){angular.module("app").factory("mvUser",function(i){var r=i("/api/users/:id",{_id:"@id"},{update:{method:"PUT",isArray:!1}});return r.prototype.isAdmin=function(){return this.roles&&this.roles.indexOf("admin")>-1},r})}();
!function(){angular.module("app").controller("mvUserListController",function(r,n){r.users=n.query()})}();
!function(){angular.module("app").directive("ngFocus",function(n){return{link:function(u,i,o){u.$watch(o.ngFocus,function(u){angular.isDefined(u)&&u&&n(function(){i[0].focus()})},!0),i.bind("blur",function(){angular.isDefined(o.ngFocusLost)&&u.$apply(o.ngFocusLost)})}}})}();
!function(){angular.module("app").value("mvToastr",toastr),angular.module("app").factory("mvNotifier",function(r){return{notify:function(o){r.success(o)},error:function(o){r.error(o)}}})}();
!function(){angular.module("app").directive("scroll",function(e){return function(n,r,t){angular.element(e).bind("scroll",function(){this.pageYOffset>=Number(t.triggerheight)&&n.$eval(t.trigger),n.$apply()})}})}();
!function(){function a(a,e){a.labels=[],a.series=["wpm","error","wasted keys"],a.data=[[],[],[]],e.query(function(e){console.log(e),_.forEach(e,function(e,o){a.labels.push(o),a.data[0].push(e.wpm),a.data[1].push(100*e.errorPercentage),a.data[2].push(e.wastedKeyStrokes)})})}angular.module("app").controller("mvDashBoardController",a)}();
!function(){angular.module("app").factory("mvExerciseDataService",function(e){var r={};return r.setData=function(e){e.wpm&&(r.wpm=e.wpm),e.errorPercentage&&(r.errorPercentage=e.errorPercentage),e.wastedKeyStrokes&&(r.wastedKeyStrokes=e.wastedKeyStrokes)},r.save=function(r){console.log(r),e.save({score:r})},r})}();
!function(){angular.module("app").factory("mvExercises",function(i){var e=i("/api/exercises/:_id",{_id:"@id"});return e})}();
!function(){function o(o,n){o.imgSrcMap={JavaScript:"../../img/javascript-logo-50.png",Ruby:"../../img/ruby-logo-50.png",Python:"../../img/python-logo-50.png"},o.exercises=n.query()}angular.module("app").controller("mvExercisesController",o)}();
!function(){angular.module("app").controller("mvMainController",function(n){n.labels=["js","rb","js","py","js","js","js"],n.series=["wpm","wasted keys","error"],n.data=null,n.triggerFunction=function(){n.data||(n.data=[[10,12,18,25,16,22,23],[40,34,30,32,18,16,20],[15,10,12,8,5,5,7,8]])}})}();
!function(){angular.module("app").controller("mvResultsController",function(e,r,t,o){e.identity=o,e.wpm=t.wpm,e.errorPercentage=t.errorPercentage,e.wastedKeyStrokes=t.wastedKeyStrokes,e.saveResults=function(){t.save({wpm:e.wpm,errorPercentage:e.errorPercentage,wastedKeyStrokes:e.wastedKeyStrokes}),r.path("/dashboard")}})}();
!function(){angular.module("app").filter("percentage",["$filter",function(n){return function(r,t){return r?n("number")(100*r,t)+" %":null}}])}(),function(){angular.module("app").filter("formatTimer",function(){return function(n){function r(n){return(10>n?"0":"")+n}{var t=n%60,u=Math.floor(n/60);Math.floor(u/60)}return r(u)+":"+r(t)}})}();
!function(){function t(t,n,e,o,r,c,i,u){function a(){i.get({_id:u.id},function(t){n.language=t.language,s(t.content)})}function s(t){n.wordCount=f(t),_.each(t,function(t){n.promptStack.push(t)})}function p(){n.clock.stop(),c.setData({wpm:l(),wastedKeyStrokes:k(),errorPercentage:g()}),e.path("/results")}function l(){return n.inputStack.length/5/(n.clock.seconds/60)}function k(){return n.keyCount-n.inputStack.length}function g(){return n.errorCount/n.keyCount}function f(t){return t.split(/\s+/).length}function y(t){var e,o,r;return e=13===t.keyCode?"\n":String.fromCharCode(t.keyCode),o=v(e,n.inputStack,n.promptStack),r=[e,o]}function v(t,n,e){return t===e[n.length]?!0:!1}n.inputStack=[],n.promptStack=[],n.wordCount=0,n.keyCount=0,n.errorCount=0,n.wordsPerMinute=null,n.wastedKeyCount=null,n.error=null,n.active=!1,n.imgSrcMap={JavaScript:"../../img/javascript-logo-50.png",Ruby:"../../img/ruby-logo-50.png",Python:"../../img/python-logo-50.png"},n.$on("keypress-q",function(t){n.keyPress(t)}),a(),n.clock={seconds:0,active:!1,start:function(){this.active=!0,this.tick()},stop:function(){this.active=!1},tick:function(){var t=this;setTimeout(function(){t.seconds++,t.active&&(t.tick(),n.$digest())},1e3)}},n.keyDown=function(t){return n.active?void(8===t.keyCode?(n.keyCount++,n.inputStack.pop(),t.preventDefault()):9===t.keyCode?t.preventDefault():81===t.keyCode&&t.altKey&&p()):!1},n.startSession=function(){n.active=!0,n.clock.start()},n.keyPress=function(t){n.active||n.startSession(),t.preventDefault(),n.keyCount++,n.inputStack.length===n.promptStack.length&&p();var e=y(t);e[1]||n.errorCount++,n.inputStack.push(e)}}angular.module("app").controller("mvTypingController",["$rootScope","$scope","$location","$sce","$window","mvExerciseDataService","mvExercises","$routeParams",t])}();